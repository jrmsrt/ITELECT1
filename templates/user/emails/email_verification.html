{% extends 'user/form_header.html' %}

{% block content %}

<title>Verify Account - BookHaven</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/user/email_verification.css') }}">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="/static/js/validation.js"></script>

<div class="verification-container">
    <div class="verification-card">

        <h1 class="verification-title">VERIFICATION</h1>

        <form method="POST" action="" id="verifyForm">

            <div id="alertBox"
                class="alert {% if msg %}{{ msg_type }}{% else %}hidden{% endif %}">
                <span class="alert-text">{{ msg or '' }}</span>
                <button type="button" class="close-btn" onclick="closeAlert()">Ã—</button>
            </div>

            <div class="otp-group">
                <input type="text" maxlength="1" class="otp-input" name="code1">
                <input type="text" maxlength="1" class="otp-input" name="code2">
                <input type="text" maxlength="1" class="otp-input" name="code3">
                <input type="text" maxlength="1" class="otp-input" name="code4">
                <input type="text" maxlength="1" class="otp-input" name="code5">
                <input type="text" maxlength="1" class="otp-input" name="code6">
            </div>

            <input type="hidden" name="code" id="verificationCode">

            <p class="verification-subject">Email Verification Required</p>

            <p class="verification-text">
                If the email address you provided really exists, a 6-digit verification code has been sent to complete your registration.
            </p>

            <button type="submit" class="verify-btn">Verify Email</button>

        </form>

        <!-- SECOND FORM MUST BE COMPLETELY SEPARATE -->
        <form method="POST" action="{{ url_for('resend_code') }}">
            <button type="submit" class="resend-btn">Re-Send Code</button>
        </form>

    </div>
</div>

{% if verified_success %}
<script>
Swal.fire({
    icon: 'success',
    title: 'Verification Successful!',
    text: 'Your email has been successfully verified. You may now log in.',
    confirmButtonText: 'Proceed to Login',
    allowOutsideClick: false,
    allowEscapeKey: false,
    customClass: {
        confirmButton: 'swal-confirm-btn'
    }
}).then(() => {
    window.location.href = "{{ url_for('user_login') }}";
});
</script>
{% endif %}

{% endblock %}