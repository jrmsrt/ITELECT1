{% extends 'user/main_header.html' %}

{% block content %}

<title>Favorites | BookHaven</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/user/favorites.css') }}">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="{{ url_for('static', filename='js/books.js') }}" defer></script>

<section class="favorites">
    <h2>Your Favorites <span>Collection</span></h2>
    <p class="subtitle">
        All the books you've loved and saved in one cozy shelf.
    </p>

    {% if books|length > 0 %}

    <!-- Search + Filters -->
    <div class="filter-bar">
        <input type="text" id="searchBar" placeholder="Search by title, author, or genre..." class="search-input">

        <select class="filter-select" id="titleFilter">
            <option value="">Filter by Title</option>
            {% for book in books %}
                <option value="{{ book.title }}">{{ book.title }}</option>
            {% endfor %}
        </select>

        <select class="filter-select" id="authorFilter">
            <option value="">Filter by Author</option>
            {% for book in books %}
                <option value="{{ book.author }}">{{ book.author }}</option>
            {% endfor %}
        </select>

        <select class="filter-select" id="genreFilter">
            <option value="">Filter by Genre</option>
            {% for book in books %}
                <option value="{{ book.genre }}">{{ book.genre }}</option>
            {% endfor %}
        </select>

        <button class="filter-btn" onclick="applyFilters()">
            <i class="fa-solid fa-filter"></i> Apply
        </button>

        <button class="reset-btn" onclick="resetFilters()">
            <i class="fa-solid fa-rotate-left"></i> Reset
        </button>
    </div>

    <div class="results-count" id="resultCount">
        Showing {{ books|length }} results
    </div>

    <!-- BOOK GRID -->
    <div class="book-grid" id="bookGrid">
        {% for book in books %}
        <div class="book-card"
             data-title="{{ book.title|lower }}"
             data-author="{{ book.author|lower }}"
             data-genre="{{ book.genre|lower }}"
             data-description="{{ book.description|lower }}">

            <div class="book-cover">
                {% if book.cover %}
                    <img src="{{ url_for('static', filename='uploads/' ~ book.cover) }}">
                {% else %}
                    <img src="/static/images/no-cover.png">
                {% endif %}
            </div>

            <h3 class="book-title">{{ book.title }}</h3>
            <p class="book-meta">
                by <span>{{ book.author }}</span> | {{ book.genre }}
            </p>
            <p class="desc">{{ book.description }}</p>

            <div class="price-stock">
                <span class="price">₱{{ "{:,.2f}".format(book.price) }}</span>

                {% if book.stock_quantity > 0 %}
                    <span class="stock">{{ book.stock_quantity }} in stock</span>
                {% else %}
                    <span class="stock out">Out of Stock</span>
                {% endif %}
            </div>

            <div class="book-bottom-actions">
                <button class="action-btn unfav" onclick="confirmUnfavorite('{{ book.id }}')">
                    <i class="fa-solid fa-heart-crack"></i> Unfavorite
                </button>

                <button class="action-btn details">
                    <i class="fas fa-info-circle"></i> Details
                </button>
            </div>
        </div>
        {% endfor %}
    </div>

    {% else %}

    <!-- EMPTY STATE -->
    <div class="no-favorites">
        <i class="fa-solid fa-heart-crack"></i>
        <h3>No favorites yet</h3>
        <p>Your favorites shelf looks empty.<br>
        Start exploring and save the books you love!</p>
    </div>

    {% endif %}

    <!-- MODAL (Always Available Even If No Books) -->
    <div class="modal-overlay" id="bookModal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>

            <div class="modal-body">
                <div class="modal-left">
                    <img id="modalCover" src="" alt="Book Cover">
                    <p class="modal-stock" id="modalStock"></p>
                </div>

                <div class="modal-right">
                    <h2 id="modalTitle"></h2>
                    <p class="modal-author">by <span id="modalAuthor"></span></p>
                    <p class="modal-genre" id="modalGenre"></p>

                    <div class="modal-description" id="modalDescription"></div>

                    <p class="modal-price">Price: <span id="modalPrice"></span></p>

                    <button class="modal-add-cart">
                        <i class="fas fa-shopping-cart"></i> Add to Cart
                    </button>
                </div>
            </div>
        </div>
    </div>

</section>

{% endblock %}
