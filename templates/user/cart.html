{% extends 'user/main_header.html' %}

{% block content %}

<title>My Cart | BookHaven</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/user/cart.css') }}">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{{ url_for('static', filename='js/cart.js') }}" defer></script>

<div class="my-cart">
  <!-- LEFT SECTION -->
  <div class="cart-details">
    <h2>My Cart</h2>
    <p class="subtext">
      {% if total_items %}
        {{ total_items }} item{{ 's' if total_items != 1 else '' }} in your cart
      {% else %}
        Your cart is empty
      {% endif %}
    </p>

    <div class="cart-header">
        <span class="header-select">
            <input type="checkbox" id="select-all">
        </span>
        <span class="header-details">Book Details</span>
        <span class="header-price">Unit Price</span>
        <span class="header-qty">Quantity</span>
        <span class="header-total">Total Price</span>
        <span class="header-action">Action</span>
    </div>

    <div class="cart-items-content">
      {% if items %}
        {% for item in items %}
        <div class="cart-item">
          <!-- Book details -->
          <div class="select-item">
              <input type="checkbox"
                    class="item-checkbox"
                    value="{{ item.cart_id }}">
          </div>

          <div class="book-info">
            {% if item.cover %}
              <img src="{{ url_for('static', filename='uploads/' ~ item.cover) }}"
                   alt="{{ item.title }}" class="cart-img">
            {% else %}
              <img src="/static/images/no-cover.png"
                   alt="{{ item.title }}" class="cart-img">
            {% endif %}
            <div class="cart-item-info">
              <h3>{{ item.title }}</h3>
              <p class="author">{{ item.author }}</p>
              <p class="genre">{{ item.genre }}</p>
            </div>
          </div>

          <!-- Unit price -->
          <p class="item-price">₱{{ "{:,.2f}".format(item.price) }}</p>

          <!-- Quantity -->
          <div class="qty-input"
               data-cart-id="{{ item.cart_id }}"
               data-unit-price="{{ item.price }}"
               data-stock="{{ item.stock_quantity }}">
            <button class="qty-count qty-count--minus" data-action="minus" type="button">-</button>
            <input class="product-qty"
                   type="number"
                   name="product-qty"
                   min="1"
                   max="10"
                   value="{{ item.quantity }}">
            <button class="qty-count qty-count--add" data-action="add" type="button">+</button>
          </div>

          <!-- Total price for this line -->
          <p class="item-total">
            ₱{{ "{:,.2f}".format(item.price * item.quantity) }}
          </p>

          <!-- Delete -->
          <form id="delete-form-{{ item.cart_id }}"
                action="{{ url_for('remove_from_cart', cart_id=item.cart_id) }}"
                method="post">

              <button class="remove-btn delete-item-btn"
                      type="button"
                      data-cart-id="{{ item.cart_id }}">
                  <i class="fa-solid fa-trash"></i>
              </button>

          </form>
        </div>
        {% endfor %}
      {% else %}
      <div class="empty-cart">
          <img src="{{ url_for('static', filename='media/empty-cart.png') }}"
              alt="Empty Cart" class="empty-cart-img">

          <h3>Your cart is empty.</h3>
          <p>Every adventure starts with a single page. <br>
             Browse our collection and discover your next great read!</p>

          <a href="{{ url_for('shop_books') }}" class="empty-cart-btn">
              Browse Books
          </a>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- RIGHT SECTION -->
  <div class="order-summary">
    <h2><i class="fa-solid fa-cart-shopping"></i> Order Summary</h2>

    <div class="summary-item">
      <span id="summary-items">Subtotal ({{ total_items or 0 }} item{{ '' if (total_items or 0) == 1 else 's' }})</span>
      <span class="summary-item-total">₱{{ "{:,.2f}".format(subtotal or 0) }}</span>
    </div>

    <div class="summary-item">
      <span>Shipping</span>
      <span class="free">Free</span>
    </div>

    <div class="summary-item">
      <span>Taxes</span>
      <span>Calculated at checkout</span>
    </div>

    <div class="fulfillment">
      <h3>Fulfillment Method</h3>
      <label class="radio">
        <input name="radio" type="radio" checked>
        <span>Pick-up</span>
      </label>

      <label class="radio">
        <input name="radio" type="radio">
        <span>Delivery</span>
      </label>
    </div>

    <div class="summary-total">
      <span>Total</span>
      <span class="total-amount">₱{{ "{:,.2f}".format(subtotal or 0) }}</span>
    </div>

    <form id="checkout-form" action="{{ url_for('checkout') }}" method="POST">
        <input type="hidden" name="selected_items" id="selected-items-input">

        <button type="submit" class="checkout-btn">
            Proceed to Checkout <i class="fa-solid fa-arrow-right"></i>
        </button>
    </form>

    <div class="continue-btn">
      <a href="{{ url_for('shop_books') }}">Continue Shopping</a>
    </div>
  </div>
</div>

{% endblock %}
