{% extends 'admin/sidebar.html' %}

{% block content %}

<title>Edit Book</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin/edit_book.css') }}">
<link href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>
<script src="{{ url_for('static', filename='js/books.js') }}" defer></script>

<div class="main-container">
    <div class="content">

        <!-- Start FORM (wraps both columns) -->
        <form id="editBookForm"
              method="POST"
              action="{{ url_for('update_book') }}"
              enctype="multipart/form-data"
              style="display: flex; width: 100%; gap: 20px;">

            <input type="hidden" name="id" value="{{ book.id }}">

            <!-- LEFT SIDE (Image & Upload) -->
            <div class="left-container">
                <h2>Edit Book</h2>

                <div class="image-preview-wrapper">
                    <div class="image-preview" id="imagePreview">

                        {% if book.cover %}
                            <img id="preview-img"
                                 src="{{ url_for('static', filename='uploads/' ~ book.cover) }}"
                                 alt="Book Cover">
                        {% else %}
                            <span id="placeholder-text">Book Cover</span>
                            <img id="preview-img" src="#" alt="Preview" style="display:none;">
                        {% endif %}

                    </div>
                </div>

                <!-- File upload BELOW the preview (INSIDE form) -->
                <div class="file-upload-wrapper">
                    <input type="file" id="coverInput" name="cover"
                           accept="image/*" onchange="previewImage(event)">
                </div>
            </div>

            <!-- RIGHT SIDE (Form Fields) -->
            <div class="right-container">
                <h2>Details</h2>

                <label>Title:</label>
                <input type="text" name="title" value="{{ book.title }}" placeholder="Enter the book's title" required>

                <label>Author:</label>
                <input type="text" name="author" value="{{ book.author }}" placeholder="Enter the author's name" required>

                <label>Genre:</label>
                <input type="text" name="genre" value="{{ book.genre }}" id="genreInput" placeholder="Add genres..." required>
                
                <label>ISBN</label>
                <input type="text" name="isbn" value="{{ book.isbn }}" placeholder="Enter book's ISBN (e.g., 978-xxx-xxxx-x)" required>


                <div class="flex-row">
                    <div class="input-group">
                        <label>Stock Quantity:</label>
                        <input type="number" name="stock_quantity" min="0"
                               value="{{ book.stock_quantity }}" placeholder="Specify stock quantiy" required>
                    </div>

                    <div class="input-group">
                        <label>Price (â‚±):</label>
                        <input type="number" name="price" min="0" step="0.01"
                               value="{{ book.price }}" placeholder="Specify the price" required>
                    </div>
                </div>

                <label>Description:</label>
                <textarea name="description" rows="3" placeholder="Write a short description or summary of the book..." required>{{ book.description }}</textarea>

                <!-- BUTTONS -->
                <div class="button-group">
                    <button type="submit" class="save-btn">
                        <i class="fa-solid fa-floppy-disk"></i> Save Changes
                    </button>

                    <button type="button" class="reset-btn" onclick="resetForm()">
                        <i class="fa-solid fa-rotate-left"></i> Reset
                    </button>

                    <a href="{{ url_for('manage_books') }}" class="cancel-btn">
                        <i class="fa-solid fa-xmark"></i> Cancel
                    </a>
                </div>
            </div>
        </form>
        <!-- End Form -->

    </div>
</div>

{% endblock %}
